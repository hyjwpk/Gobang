import{Model as t}from"../Models/Model.js";import{View as s}from"../Views/View.js";export class Controller{constructor(i,h,o,c){this.computerFirst=!0,this.model=new t(h,o,c,this.computerFirst);const e=(o-1)*c,r=(h-1)*c;if(this.canvas=document.getElementById(i),this.originX=(this.canvas.width-e)/2,this.originY=(this.canvas.height-r)/2,this.model.chessboard.originX=this.originX,this.model.chessboard.originY=this.originY,this.view=new s(i),this.view.drawChessboard(this.model.chessboard),this.registerClickEvent(c),this.registerStartGameEvent(),this.registerUndoEvent(),this.registerComputerFirstEvent(),this.registerToggleNumberEvent(),this.computerFirst){const t=this.model.getMove();if(t){const{row:s,col:i}=t;this.model.putChess(s,i)&&this.view.drawChess(this.model.chessboard,s,i,"black"!==this.model.currentPlayer)}}}registerClickEvent(t){this.canvas.addEventListener("click",(s=>{const i=this.canvas.getBoundingClientRect(),h=s.clientX-i.left,o=s.clientY-i.top,c=Math.round((h-this.originX)/t),e=Math.round((o-this.originY)/t);if(this.model.putChess(e,c)){if(this.view.drawChess(this.model.chessboard,e,c,"black"!==this.model.currentPlayer),this.model.gameIsOver)return void alert(("black"===this.model.currentPlayer?"白方":"黑方")+"获胜！");const t=this.model.getMove({row:e,col:c});if(t){const{row:s,col:i}=t;this.model.putChess(s,i)&&(this.view.drawChess(this.model.chessboard,s,i,"black"!==this.model.currentPlayer),this.model.gameIsOver&&alert(("black"===this.model.currentPlayer?"白方":"黑方")+"获胜！"))}}}))}registerStartGameEvent(){const s=document.getElementById("startButton");s&&s.addEventListener("click",(()=>{if(this.model=new t(this.model.chessboard.rows,this.model.chessboard.cols,this.model.chessboard.cellSize,this.computerFirst),this.model.chessboard.originX=this.originX,this.model.chessboard.originY=this.originY,this.view.redrawChessboard(this.model.chessboard,[]),this.computerFirst){const t=this.model.getMove();if(t){const{row:s,col:i}=t;this.model.putChess(s,i)&&this.view.drawChess(this.model.chessboard,s,i,"black"!==this.model.currentPlayer)}}}))}registerUndoEvent(){const t=document.getElementById("undoButton");t&&t.addEventListener("click",(()=>{this.model.undoLastMove(),this.view.redrawChessboard(this.model.chessboard,this.model.moves)}))}registerComputerFirstEvent(){const t=document.getElementById("computerFirstSwitch");t&&t.addEventListener("change",(()=>{this.computerFirst=t.checked}))}registerToggleNumberEvent(){const t=document.getElementById("toggleNumbers");t&&t.addEventListener("change",(()=>{this.view.toggleShowNumbers(),this.view.redrawChessboard(this.model.chessboard,this.model.moves)}))}}