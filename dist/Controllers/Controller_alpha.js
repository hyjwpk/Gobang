var t=this&&this.__awaiter||function(t,i,s,h){return new(s||(s=Promise))((function(o,c){function n(t){try{r(h.next(t))}catch(t){c(t)}}function e(t){try{r(h.throw(t))}catch(t){c(t)}}function r(t){var i;t.done?o(t.value):(i=t.value,i instanceof s?i:new s((function(t){t(i)}))).then(n,e)}r((h=h.apply(t,i||[])).next())}))};import{Model as i}from"../Models/Model_alpha.js";import{View as s}from"../Views/View.js";export class Controller{constructor(t,h,o,c){this.computerFirst=!0,this.model=new i(h,o,c,this.computerFirst);const n=(o-1)*c,e=(h-1)*c;if(this.canvas=document.getElementById(t),this.originX=(this.canvas.width-n)/2,this.originY=(this.canvas.height-e)/2,this.model.chessboard.originX=this.originX,this.model.chessboard.originY=this.originY,this.view=new s(t),this.view.drawChessboard(this.model.chessboard),this.registerClickEvent(c),this.registerStartGameEvent(),this.registerUndoEvent(),this.registerComputerFirstEvent(),this.registerToggleNumberEvent(),this.computerFirst){const t={row:Math.floor(h/2),col:Math.floor(o/2)};if(t){const{row:i,col:s}=t;this.model.putChess(i,s)&&this.view.drawChess(this.model.chessboard,i,s,"black"!==this.model.currentPlayer)}}}registerClickEvent(i){this.canvas.addEventListener("click",(s=>t(this,void 0,void 0,(function*(){const t=this.canvas.getBoundingClientRect(),h=s.clientX-t.left,o=s.clientY-t.top,c=Math.round((h-this.originX)/i),n=Math.round((o-this.originY)/i);if(this.model.putChess(n,c)){if(this.view.drawChess(this.model.chessboard,n,c,"black"!==this.model.currentPlayer),this.model.gameIsOver)return void alert(("black"===this.model.currentPlayer?"白方":"黑方")+"获胜！");const t=yield this.model.getMove({row:n,col:c});if(t){const{row:i,col:s}=t;this.model.putChess(i,s)&&(this.view.drawChess(this.model.chessboard,i,s,"black"!==this.model.currentPlayer),this.model.gameIsOver&&alert(("black"===this.model.currentPlayer?"白方":"黑方")+"获胜！"))}}}))))}registerStartGameEvent(){const t=document.getElementById("startButton");t&&t.addEventListener("click",(()=>{if(this.model=new i(this.model.chessboard.rows,this.model.chessboard.cols,this.model.chessboard.cellSize,this.computerFirst),this.model.chessboard.originX=this.originX,this.model.chessboard.originY=this.originY,this.view.redrawChessboard(this.model.chessboard,[]),this.computerFirst){const t={row:Math.floor(this.model.chessboard.rows/2),col:Math.floor(this.model.chessboard.cols/2)};if(t){const{row:i,col:s}=t;this.model.putChess(i,s)&&this.view.drawChess(this.model.chessboard,i,s,"black"!==this.model.currentPlayer)}}}))}registerUndoEvent(){const t=document.getElementById("undoButton");t&&t.addEventListener("click",(()=>{this.model.undoLastMove(),this.view.redrawChessboard(this.model.chessboard,this.model.moves)}))}registerComputerFirstEvent(){const t=document.getElementById("computerFirstSwitch");t&&t.addEventListener("change",(()=>{this.computerFirst=t.checked}))}registerToggleNumberEvent(){const t=document.getElementById("toggleNumbers");t&&t.addEventListener("change",(()=>{this.view.toggleShowNumbers(),this.view.redrawChessboard(this.model.chessboard,this.model.moves)}))}}